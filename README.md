Puppet Profile Parser
=====================

[![Build Status](https://travis-ci.org/Sharpie/puppet-profile-parser.svg?branch=master)](https://travis-ci.org/Sharpie/puppet-profile-parser)

Tools for parsing profile information from Puppet Server logs.


Installation
------------

The tool in this repository is the `profile-parser.rb` script. This script
has no dependencies and can be run from any location where a Ruby interpreter
is present on the `PATH`.

Ruby 2.1 or newer is recommended.


Usage
-----

### Collecting Profiles

The `profile-parser.rb` script scans Puppet Server logs for information
generated by Puppet profiling code. This profiling code must be activated
using Puppet's [profile setting][profile-setting].

  [profile-setting]: https://puppet.com/docs/puppet/5.4/configuration.html#profile

#### Profiling specific agents

A single server profile can be collected for an agent by executing a test run
with the `--profile` flag:

    puppet agent -t --profile

Setting `profile=true` in the `[agent]` section of `puppet.conf` and restarting
the `puppet` daemon will cause all runs to generate server profiling
information. The profile results will be located in the Puppet Server logs.

#### Profiling all agents

Profiling can be enabled globally by setting `profile=true` in the `[master]`
section of `puppet.conf` and restarting the `puppetserver` daemon.

### Parsing Profiles

The `profile-parser.rb` script expects list of Puppet Server
log files containing `PROFILE` entries:

    ./profile-parser.rb .../path/to/puppetserver.log [.../more/logs]

The tool defaults to a human-readable summary. Additional formats can be
selected using the `--format` flag. For example, to generate output for
[brendangregg/FlameGraph](https://github.com/brendangregg/FlameGraph):

    ./profile-parser.rb --format flamegraph puppetserver.log | \
      path/to/flamegraph.pl --countname ms > puppet_profile.svg
